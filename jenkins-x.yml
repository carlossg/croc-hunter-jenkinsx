buildPack: none
pipelineConfig:
  extends:
    import: classic
    file: go/pipeline.yaml
  pipelines:
    pullRequest:
      build:
        steps:
        - sh: export VERSION=$PREVIEW_VERSION && skaffold build -f skaffold-temp.yaml
          name: container-build
      postBuild:
        steps:
        - sh: jx step post build --image $DOCKER_REGISTRY/$ORG/$APP_NAME:$PREVIEW_VERSION
          name: post-build

# buildPack: none
# pipelineConfig:
#   pipelines:
#     pullRequest:
#       pipeline:
#         agent:
#           image: docker.io/golang:stretch
#         stages:
#           - name: build-binary
#             steps:
#               - command: make
#                 args:
#                   - build
#           - name: build-image
#             environment:
#               - name: ORG
#                 value: go-exchange-staging
#             agent:
#               image: gcr.io/kaniko-project/executor:latest
#             steps:
#               - args: ["--dockerfile=./Dockerfile",
#                         "--context=gs://<GCS bucket>/<path to .tar.gz>",
#                         "--destination=<asia.gcr.io/$PROJECT/$IMAGE:$TAG>"]